<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>聚合函数 | SLS 案例中心</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/vuepress-test-blog/assets/css/0.styles.6e4ddb4c.css" as="style"><link rel="preload" href="/vuepress-test-blog/assets/js/app.1b4f8edd.js" as="script"><link rel="preload" href="/vuepress-test-blog/assets/js/2.bce32082.js" as="script"><link rel="preload" href="/vuepress-test-blog/assets/js/13.2859ca6f.js" as="script"><link rel="prefetch" href="/vuepress-test-blog/assets/js/10.f2caa58f.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/11.22d7b858.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/12.e294d9fd.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/14.c16a383d.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/15.ae954753.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/16.3c3f31da.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/17.0e5d6f5f.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/3.7104bd07.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/4.844b6742.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/5.7ea1e1bb.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/6.af602993.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/7.fb3145f4.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/8.31227a9a.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/9.00dfaa5e.js">
    <link rel="stylesheet" href="/vuepress-test-blog/assets/css/0.styles.6e4ddb4c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-test-blog/" class="home-link router-link-active"><!----> <span class="site-name">SLS 案例中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-test-blog/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/vuepress-test-blog/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="/vuepress-test-blog/sqlfun/" class="nav-link router-link-active">
  SQL函数
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-test-blog/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/vuepress-test-blog/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="/vuepress-test-blog/sqlfun/" class="nav-link router-link-active">
  SQL函数
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SQL函数</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-test-blog/sqlfun/" aria-current="page" class="sidebar-link">函数概览</a></li><li><a href="/vuepress-test-blog/sqlfun/1聚合函数.html" class="active sidebar-link">聚合函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#arbitrary函数" class="sidebar-link">arbitrary函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#avg函数" class="sidebar-link">avg函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#bitwise-and-agg函数" class="sidebar-link">bitwiseandagg函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#bitwise-or-agg函数" class="sidebar-link">bitwiseoragg函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#bool-and函数" class="sidebar-link">bool_and函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#bool-or函数" class="sidebar-link">bool_or函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#checksum函数" class="sidebar-link">checksum函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#count函数" class="sidebar-link">count函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#count-if函数" class="sidebar-link">count_if函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#geometric-mean函数" class="sidebar-link">geometric_mean函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#every函数" class="sidebar-link">every函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#kurtosis函数" class="sidebar-link">kurtosis函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#map-union函数" class="sidebar-link">map_union函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#max函数" class="sidebar-link">max函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#max-by函数" class="sidebar-link">max_by函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#min函数" class="sidebar-link">min函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#min-by函数" class="sidebar-link">min_by函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#skewness函数" class="sidebar-link">skewness函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/1聚合函数.html#sum函数" class="sidebar-link">sum函数</a></li></ul></li><li><a href="/vuepress-test-blog/sqlfun/2字符串函数.html" class="sidebar-link">字符串函数</a></li><li><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html" class="sidebar-link">日期和时间函数</a></li><li><a href="/vuepress-test-blog/sqlfun/4JSON函数.html" class="sidebar-link">JSON函数</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="聚合函数"><a href="#聚合函数" class="header-anchor">#</a> 聚合函数</h1> <p>聚合函数用于对目标数值执行计算并返回结果。本文介绍聚合函数的基本语法及示例。</p> <h1 id="函数示例"><a href="#函数示例" class="header-anchor">#</a> 函数示例</h1> <p>日志服务支持如下聚合函数。</p> <blockquote><p>在日志服务分析语句中，表示字符串的字符必须使用单引号（''）包裹，无符号包裹或被双引号（&quot;&quot;）包裹的字符表示字段名或列名。例如：'status'表示字符串status，status或&quot;status&quot;表示日志字段status。</p></blockquote> <table><thead><tr><th>函数名称</th> <th>语法</th> <th>说明</th></tr></thead> <tbody><tr><td><a href="#arbitrary%E5%87%BD%E6%95%B0">arbitrary函数</a></td> <td>arbitrary( <em>x</em> )</td> <td>返回 <em>x</em> 中任意一个非空的值。</td></tr> <tr><td><a href="#avg%E5%87%BD%E6%95%B0">avg函数</a></td> <td>avg( <em>x</em> )</td> <td>计算 <em>x</em> 的算术平均值。</td></tr> <tr><td><a href="#bitwise_and_agg%E5%87%BD%E6%95%B0">bitwise_and_agg函数</a></td> <td>bitwise_and_agg( <em>x</em> )</td> <td>返回 <em>x</em> 中所有值按位与运算（AND）的结果。</td></tr> <tr><td><a href="#bitwise_or_agg%E5%87%BD%E6%95%B0">bitwise_or_agg函数</a></td> <td>bitwise_or_agg( <em>x</em> )</td> <td>返回 <em>x</em> 中所有值按位或运算（OR）的结果。</td></tr> <tr><td><a href="#bool_and%E5%87%BD%E6%95%B0">bool_and函数</a></td> <td>bool_and( <em>boolean expression</em> )</td> <td>判断是否所有日志都满足条件。如果是，则返回true。 bool_and函数等同于every函数。</td></tr> <tr><td><a href="#bool_or%E5%87%BD%E6%95%B0">bool_or函数</a></td> <td>bool_or( <em>boolean expression</em> )</td> <td>判断是否存在日志满足条件。如果存在，则返回true。</td></tr> <tr><td><a href="#checksum%E5%87%BD%E6%95%B0">checksum函数</a></td> <td>checksum( <em>x</em> )</td> <td>计算 <em>x</em> 的校验和。</td></tr> <tr><td><a href="#LogService-user-guide-0103/section-ofd-ty2-ncw">count函数</a></td> <td>count(*)</td> <td>统计所有的日志条数。</td></tr> <tr><td><a href="#count%E5%87%BD%E6%95%B0">count函数</a></td> <td>count(1)</td> <td>统计所有的日志条数，等同于count(*)。</td></tr> <tr><td><a href="#count%E5%87%BD%E6%95%B0">count函数</a></td> <td>count( <em>x</em> )</td> <td>统计 <em>x</em> 中值不为NULL的日志条数。</td></tr> <tr><td><a href="#count_if%E5%87%BD%E6%95%B0">count_if函数</a></td> <td>count_if( <em>boolean expression</em> )</td> <td>统计满足指定条件的日志条数。</td></tr> <tr><td><a href="#every%E5%87%BD%E6%95%B0">every函数</a></td> <td>every( <em>boolean expression</em> )</td> <td>判断是否所有日志都满足条件。如果是，则返回true。 every函数等同于bool_and函数。</td></tr> <tr><td><a href="#geometric_mean%E5%87%BD%E6%95%B0">geometric_mean函数</a></td> <td>geometric_mean( <em>x</em> )</td> <td>计算 <em>x</em> 的几何平均数。</td></tr> <tr><td><a href="#kurtosis%E5%87%BD%E6%95%B0">kurtosis函数</a></td> <td>kurtosis( <em>x</em> )</td> <td>计算 <em>x</em> 的峰度。</td></tr> <tr><td><a href="#map_union%E5%87%BD%E6%95%B0">map_union函数</a></td> <td>map_union( <em>x</em> )</td> <td>返回一列Map数据的并集。 如果Map中存在相同的键，则返回的键值为其中任意一个键的值。</td></tr> <tr><td><a href="#max%E5%87%BD%E6%95%B0">max函数</a></td> <td>max( <em>x</em> )</td> <td>查询 <em>x</em> 中的最大值。</td></tr> <tr><td><a href="#max%E5%87%BD%E6%95%B0">max函数</a></td> <td>max( <em>x</em> , <em>n</em> )</td> <td>查询 <em>x</em> 中最大的 <em>n</em> 个值。返回结果为数组。</td></tr> <tr><td><a href="#max_by%E5%87%BD%E6%95%B0">max_by函数</a></td> <td>max_by( <em>x</em> , <em>y</em> )</td> <td>查询 <em>y</em> 为最大值时对应的 <em>x</em> 值。</td></tr> <tr><td><a href="#max_by%E5%87%BD%E6%95%B0">max_by函数</a></td> <td>max_by( <em>x</em> , <em>y</em> , <em>n</em> )</td> <td>查询最大的 <em>n</em> 个 <em>y</em> 值对应的 <em>x</em> 值，返回结果为数组。</td></tr> <tr><td><a href="#min%E5%87%BD%E6%95%B0">min函数</a></td> <td>min( <em>x</em> )</td> <td>查询 <em>x</em> 中最小值。</td></tr> <tr><td><a href="#min%E5%87%BD%E6%95%B0">min函数</a></td> <td>min( <em>x</em> , <em>n</em> )</td> <td>查询 <em>x</em> 中最小的 <em>n</em> 个值。返回结果为数组。</td></tr> <tr><td><a href="#min_by%E5%87%BD%E6%95%B0">min_by函数</a></td> <td>min_by( <em>x</em> , <em>y</em> )</td> <td>查询 <em>y</em> 为最小值时对应的 <em>x</em> 值。</td></tr> <tr><td><a href="#min_by%E5%87%BD%E6%95%B0">min_by函数</a></td> <td>min_by( <em>x</em> , <em>y</em> , <em>n</em> )</td> <td>查询最小的 <em>n</em> 个 <em>y</em> 值对应的 <em>x</em> 值。返回结果为数组。</td></tr> <tr><td><a href="#skewness%E5%87%BD%E6%95%B0">skewness函数</a></td> <td>skewness( <em>x</em> )</td> <td>计算 <em>x</em> 的偏度。</td></tr> <tr><td><a href="#sum%E5%87%BD%E6%95%B0">sum函数</a></td> <td>sum( <em>x</em> )</td> <td>计算 <em>x</em> 的总值。</td></tr></tbody></table> <h1 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h1> <h2 id="arbitrary函数"><a href="#arbitrary函数" class="header-anchor">#</a> arbitrary函数</h2> <p>arbitrary函数用于返回 <em>x</em> 中任意一个非空的值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>arbitrary(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <p>返回request_method字段中任意一个非空的字段值。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT arbitrary(request_method) AS request_method
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291885.png" alt="arbitrary函数"></p></li></ul> <h2 id="avg函数"><a href="#avg函数" class="header-anchor">#</a> avg函数</h2> <p>avg函数用于计算 <em>x</em> 的算术平均值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>avg(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为double、bigint、decimal或real类型。</td></tr></tbody></table> <p>double类型。</p> <p>返回平均延迟时间高于1000微秒的Project。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>method: PostLogstoreLogs | SELECT avg(latency) AS avg_latency, Project GROUP BY Project HAVING avg_latency &gt; 1000
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3335375261/p291909.png" alt="avg函数"></p></li></ul> <h2 id="bitwise-and-agg函数"><a href="#bitwise-and-agg函数" class="header-anchor">#</a> bitwise_and_agg函数</h2> <p>bitwise_and_agg函数用于返回 <em>x</em> 中所有值按位与运算（AND）的结果。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>bitwise_and_agg(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为bigint类型。</td></tr></tbody></table> <p>bigint类型（二进制形式）。</p> <p>对request_time字段的所有值进行按位与运算。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT bitwise_and_agg(status)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5335375261/p292744.png" alt="AND"></p></li></ul> <h2 id="bitwise-or-agg函数"><a href="#bitwise-or-agg函数" class="header-anchor">#</a> bitwise_or_agg函数</h2> <p>bitwise_or_agg函数用于返回 <em>x</em> 中所有值按位或运算（OR）的结果。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>bitwise_or_agg(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为bigint类型。</td></tr></tbody></table> <p>bigint类型（二进制形式）。</p> <p>对request_time字段的所有值进行按位或运算。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT bitwise_or_agg(request_length)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5335375261/p292743.png" alt="OR"></p></li></ul> <h2 id="bool-and函数"><a href="#bool-and函数" class="header-anchor">#</a> bool_and函数</h2> <p>bool_and函数用于判断是否所有日志都满足条件。如果是，则返回true。bool_and函数等同于every函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>bool_and(boolean expression)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>boolean expression</em></td> <td>参数值为布尔表达式。</td></tr></tbody></table> <p>boolean类型。</p> <p>判断所有请求的时间是否都小于100秒。如果是，则返回true。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT bool_and(request_time &lt; 100)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0071300361/p312823.png" alt="bool_and"></p></li></ul> <h2 id="bool-or函数"><a href="#bool-or函数" class="header-anchor">#</a> bool_or函数</h2> <p>bool_or函数用于判断是否存在日志满足条件。如果存在，则返回true。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>bool_or(boolean expression)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>boolean expression</em></td> <td>参数值为布尔表达式。</td></tr></tbody></table> <p>boolean类型。</p> <p>判断是否存在请求时间小于20秒的请求。如果存在，则返回true。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT bool_or(request_time &lt; 20)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0071300361/p312825.png" alt="bool_or"></p></li></ul> <h2 id="checksum函数"><a href="#checksum函数" class="header-anchor">#</a> checksum函数</h2> <p>checksum函数用于计算 <em>x</em> 的校验和。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>checksum(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr></tbody></table> <p>string类型（BASE 64编码）。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT checksum(request_method) AS request_method
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2263275261/p292416.png" alt="checksum"></p></li></ul> <h2 id="count函数"><a href="#count函数" class="header-anchor">#</a> count函数</h2> <p>count函数用于计数。</p> <ul><li><p>统计所有的日志条数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>count(*)
</code></pre></div></li> <li><p>统计所有的日志条数。等同于<code>count(*)</code>。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>count(1)
</code></pre></div></li> <li><p>统计 <em>x</em> 中值不为NULL的日志条数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>count(x)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr></tbody></table> <p>integer类型。</p> <ul><li><p>示例1：统计网站访问量。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT count(*) AS PV
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291915.png" alt="count函数"></p></li></ul></li> <li><p>示例2：统计包含request_method字段且字段值不为NULL的日志条数。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT count(request_method) AS count
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291918.png" alt="count函数"></p></li></ul></li></ul> <h2 id="count-if函数"><a href="#count-if函数" class="header-anchor">#</a> count_if函数</h2> <p>count_if函数用于统计满足指定条件的日志条数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>count_if(boolean expression)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>boolean expression</em></td> <td>参数值为布尔表达式。</td></tr></tbody></table> <p>integer类型。</p> <p>统计request_uri字段的值是以<code>file-0</code>结尾的日志条数。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT count_if(request_uri like '%file-0') AS count
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291918.png" alt="count函数"></p></li></ul> <h2 id="geometric-mean函数"><a href="#geometric-mean函数" class="header-anchor">#</a> geometric_mean函数</h2> <p>geometric_mean函数用于计算 <em>x</em> 的几何平均数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>geometric_mean(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为double、bigint或real类型。</td></tr></tbody></table> <p>double类型。</p> <p>统计请求时长的几何平均值。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT geometric_mean(request_time) AS time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4335375261/p292704.png" alt="geometric_mean"></p></li></ul> <h2 id="every函数"><a href="#every函数" class="header-anchor">#</a> every函数</h2> <p>every函数用于判断是否所有日志都满足条件。如果是，则返回true。every函数等同于bool_and函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>every(boolean expression)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>boolean expression</em></td> <td>参数值为布尔表达式。</td></tr></tbody></table> <p>boolean类型。</p> <p>判断所有请求的时间是否都小于100秒。如果是，则返回true。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT every(request_time &lt; 100)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0071300361/p312823.png" alt="bool_and"></p></li></ul> <h2 id="kurtosis函数"><a href="#kurtosis函数" class="header-anchor">#</a> kurtosis函数</h2> <p>kurtosis函数用于计算 <em>x</em> 的峰度。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>kurtosis(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为double、bigint类型。</td></tr></tbody></table> <p>double类型。</p> <p>计算请求时间的峰度。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>*| SELECT kurtosis(request_time)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6268030361/p313218.png" alt="kurtosis"></p></li></ul> <h2 id="map-union函数"><a href="#map-union函数" class="header-anchor">#</a> map_union函数</h2> <p>map_union函数用于返回一列Map数据的并集。 如果Map中存在相同的键，则返回的键值为其中任意一个键的值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>map_union(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为map类型。</td></tr></tbody></table> <p>map类型。</p> <p>将etl_context字段的值（map类型）聚合后，随机返回其中一个值（map类型）。</p> <ul><li><p>字段样例</p> <div class="language-unknow extra-class"><pre class="language-text"><code>etl_context: {
project:&quot;datalab-148****6461-cn-chengdu&quot;
logstore:&quot;internal-etl-log&quot;
consumer_group:&quot;etl-83****4d1965&quot;
consumer:&quot;etl-b2d40ed****c8d6-291294&quot;
shard_id:&quot;0&quot; }
</code></pre></div></li> <li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT map_union(try_cast(json_parse(etl_context) AS map(varchar,varchar)))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1015030361/p312973.png" alt=" map_union"></p></li></ul> <h2 id="max函数"><a href="#max函数" class="header-anchor">#</a> max函数</h2> <p>max函数用于查询 <em>x</em> 中最大的值。</p> <ul><li><p>查询 <em>x</em> 中最大的值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>max(x)
</code></pre></div></li> <li><p>查询 <em>x</em> 中最大的 <em>n</em> 个值，返回结果为数组。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>max(x, n)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>n</em></td> <td>参数值为正整数。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <ul><li><p>示例1：查询请求时长的最大值。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT max(request_time) AS max_request_time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291936.png" alt="MAX函数"></p></li></ul></li> <li><p>示例2：查询请求时长的top 10。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT max(request_time,10) AS &quot;top 10&quot;
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4622300361/p312832.png" alt="max"></p></li></ul></li></ul> <h2 id="max-by函数"><a href="#max-by函数" class="header-anchor">#</a> max_by函数</h2> <p>max_by函数支持如下两种用法。</p> <ul><li><p>查询 <em>y</em> 为最大值时对应的 <em>x</em> 值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>max_by(x, y)
</code></pre></div></li> <li><p>查询最大的 <em>n</em> 个 <em>y</em> 值对应的 <em>x</em> 值，返回结果为数组。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>max_by(x, y, n)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>y</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>n</em></td> <td>大于0的整数。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <ul><li><p>示例1：统计最高消费订单对应的时间点。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT max_by(UsageEndTime, PretaxAmount) as time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4335375261/p292722.png" alt="max_by"></p></li></ul></li> <li><p>示例2：统计请求时长最大的3个请求对应的请求方法。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT max_by(request_method,request_time,3) AS method
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4335375261/p292716.png" alt="max_by"></p></li></ul></li></ul> <h2 id="min函数"><a href="#min函数" class="header-anchor">#</a> min函数</h2> <p>min函数用于查询 <em>x</em> 中最小值。</p> <ul><li><p>查询 <em>x</em> 中最小值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>min(x)
</code></pre></div></li> <li><p>查询 <em>x</em> 中最小的 <em>n</em> 个值，返回结果为数组。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>min(x,n)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>n</em></td> <td>参数值为正整数。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <ul><li><p>示例1：查询请求时长的最小值。</p> <ul><li><p>查询与分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT min(request_time) AS min_request_time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4765655261/p291937.png" alt="MIN函数"></p></li></ul></li> <li><p>示例2：查询请求时长最小的10个值。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT min(request_time,10)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1071300361/p312834.png" alt="min"></p></li></ul></li></ul> <h2 id="min-by函数"><a href="#min-by函数" class="header-anchor">#</a> min_by函数</h2> <p>min_by函数支持如下两种用法。</p> <ul><li><p>查询 <em>y</em> 为最小值时对应的 <em>x</em> 值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>min_by(x, y)
</code></pre></div></li> <li><p>查询最小的 <em>n</em> 个 <em>y</em> 值对应的 <em>x</em> 值。返回结果为数组。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>min_by(x, y, n)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>y</em></td> <td>参数值为任意数据类型。</td></tr> <tr><td><em>n</em></td> <td>大于0的整数。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <ul><li><p>示例1：返回最小请求时长的请求对应的请求方法。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT min_by(request_method,request_time) AS method
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4335375261/p292727.png" alt="min_by"></p></li></ul></li> <li><p>示例2：返回请求时长最小的3个请求对应的请求方法。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT min_by(request_method,request_time,3) AS method
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4335375261/p292716.png" alt="max_by"></p></li></ul></li></ul> <h2 id="skewness函数"><a href="#skewness函数" class="header-anchor">#</a> skewness函数</h2> <p>skewness函数用于计算 <em>x</em> 的偏度。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>skewness(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为double、bigint类型。</td></tr></tbody></table> <p>double类型。</p> <p>计算请求时间的偏度。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>*| SELECT skewness(request_time) AS skewness
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7268030361/p313222.png" alt="skewness"></p></li></ul> <h2 id="sum函数"><a href="#sum函数" class="header-anchor">#</a> sum函数</h2> <p>sum函数用于计算 <em>x</em> 的总值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>sum(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为double、bigint、decimal或real类型。</td></tr></tbody></table> <p>与参数值的数据类型一致。</p> <p>计算网站每天的访问流量。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT date_trunc('day',__time__) AS time, sum(body_bytes_sent) AS body_bytes_sent GROUP BY time ORDER BY time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3515265261/p291940.png" alt="SUM函数"></p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-test-blog/sqlfun/" class="prev router-link-active">
        函数概览
      </a></span> <span class="next"><a href="/vuepress-test-blog/sqlfun/2字符串函数.html">
        字符串函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-test-blog/assets/js/app.1b4f8edd.js" defer></script><script src="/vuepress-test-blog/assets/js/2.bce32082.js" defer></script><script src="/vuepress-test-blog/assets/js/13.2859ca6f.js" defer></script>
  </body>
</html>
