<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>日期和时间函数 | SLS 案例中心</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/vuepress-test-blog/assets/css/0.styles.6e4ddb4c.css" as="style"><link rel="preload" href="/vuepress-test-blog/assets/js/app.1b4f8edd.js" as="script"><link rel="preload" href="/vuepress-test-blog/assets/js/2.bce32082.js" as="script"><link rel="preload" href="/vuepress-test-blog/assets/js/15.ae954753.js" as="script"><link rel="prefetch" href="/vuepress-test-blog/assets/js/10.f2caa58f.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/11.22d7b858.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/12.e294d9fd.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/13.2859ca6f.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/14.c16a383d.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/16.3c3f31da.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/17.0e5d6f5f.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/3.7104bd07.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/4.844b6742.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/5.7ea1e1bb.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/6.af602993.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/7.fb3145f4.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/8.31227a9a.js"><link rel="prefetch" href="/vuepress-test-blog/assets/js/9.00dfaa5e.js">
    <link rel="stylesheet" href="/vuepress-test-blog/assets/css/0.styles.6e4ddb4c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-test-blog/" class="home-link router-link-active"><!----> <span class="site-name">SLS 案例中心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-test-blog/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/vuepress-test-blog/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="/vuepress-test-blog/sqlfun/" class="nav-link router-link-active">
  SQL函数
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-test-blog/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/vuepress-test-blog/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="/vuepress-test-blog/sqlfun/" class="nav-link router-link-active">
  SQL函数
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SQL函数</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-test-blog/sqlfun/" aria-current="page" class="sidebar-link">函数概览</a></li><li><a href="/vuepress-test-blog/sqlfun/1聚合函数.html" class="sidebar-link">聚合函数</a></li><li><a href="/vuepress-test-blog/sqlfun/2字符串函数.html" class="sidebar-link">字符串函数</a></li><li><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html" class="active sidebar-link">日期和时间函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#current-date函数" class="sidebar-link">current_date函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#current-time函数" class="sidebar-link">current_time函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#current-timestamp函数" class="sidebar-link">current_timestamp函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#current-timezone函数" class="sidebar-link">current_timezone函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date函数" class="sidebar-link">date函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date-format函数" class="sidebar-link">date_format函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date-parse函数" class="sidebar-link">date_parse函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#from-iso8601-date函数" class="sidebar-link">fromiso8601date函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#from-iso8601-timestamp函数" class="sidebar-link">fromiso8601timestamp函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#from-unixtime函数" class="sidebar-link">from_unixtime函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#localtime函数" class="sidebar-link">localtime函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#localtimestamp函数" class="sidebar-link">localtimestamp函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#now函数" class="sidebar-link">now函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#to-iso8601函数" class="sidebar-link">to_iso8601函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#to-unixtime函数" class="sidebar-link">to_unixtime函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#day函数" class="sidebar-link">day函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#day-of-month函数" class="sidebar-link">dayofmonth函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#day-of-week函数" class="sidebar-link">dayofweek函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#day-of-year函数" class="sidebar-link">dayofyear函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#dow函数" class="sidebar-link">dow函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#doy函数" class="sidebar-link">doy函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#extract函数" class="sidebar-link">extract函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#hour函数" class="sidebar-link">hour函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#minute函数" class="sidebar-link">minute函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#month函数" class="sidebar-link">month函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#quarter函数" class="sidebar-link">quarter函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#second函数" class="sidebar-link">second函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#timezone-hour函数" class="sidebar-link">timezone_hour函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#timezone-minute函数" class="sidebar-link">timezone_minute函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#week函数" class="sidebar-link">week函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#week-of-year函数" class="sidebar-link">weekofyear函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#year函数" class="sidebar-link">year函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#year-of-week函数" class="sidebar-link">yearofweek函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#yow函数" class="sidebar-link">yow函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date-trunc函数" class="sidebar-link">date_trunc函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date-add函数" class="sidebar-link">date_add函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#date-diff函数" class="sidebar-link">date_diff函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#time-series函数" class="sidebar-link">time_series函数</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#format说明" class="sidebar-link">format说明</a></li><li class="sidebar-sub-header"><a href="/vuepress-test-blog/sqlfun/3日期和时间函数.html#unit说明" class="sidebar-link">unit说明</a></li></ul></li><li><a href="/vuepress-test-blog/sqlfun/4JSON函数.html" class="sidebar-link">JSON函数</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="日期和时间函数"><a href="#日期和时间函数" class="header-anchor">#</a> 日期和时间函数</h1> <p>日志服务提供时间函数、日期函数、时间截断函数、时间间隔函数和时序补全函数，支持对日志中的日期和时间进行格式转换，分组聚合等处理。本文介绍日期和时间函数的基本语法及示例。</p> <h1 id="函数示例"><a href="#函数示例" class="header-anchor">#</a> 函数示例</h1> <p>日志服务支持如下日期和时间函数。</p> <ul><li><p>日志服务中的日志时间戳精确到秒，所以配置时间格式（<a href="#LogService-user-guide-0110/section-8g8-2xm-kdv">format</a>）时，只需配置到秒，无需配置毫秒、微秒等信息。</p></li> <li><p>只需为时间字符串中的时间部分配置时间格式（<a href="#LogService-user-guide-0110/section-8g8-2xm-kdv">format</a>），其他内容（例如时区）无需配置时间格式。</p></li> <li><p>日志服务中的每条日志都包含保留字段__time__，该字段的值为UNIX时间戳格式，例如1592374067，代表2020-06-17 14:07:47。</p></li> <li><p>在日志服务分析语句中，表示字符串的字符必须使用单引号（''）包裹，无符号包裹或被双引号（&quot;&quot;）包裹的字符表示字段名或列名。例如：'status'表示字符串status，status或&quot;status&quot;表示日志字段status。</p></li></ul> <table><thead><tr><th>函数类型</th> <th>函数名称</th> <th>语法</th> <th>说明</th></tr></thead> <tbody><tr><td>日期和时间函数</td> <td><a href="#current_date%E5%87%BD%E6%95%B0">current_date函数</a></td> <td>current_date</td> <td>返回当前日期。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#current_time%E5%87%BD%E6%95%B0">current_time函数</a></td> <td>current_time</td> <td>返回当前时间和时区。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#current_timestamp%E5%87%BD%E6%95%B0">current_timestamp函数</a></td> <td>current_timestamp</td> <td>返回当前日期、时间和时区。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#current_timezone%E5%87%BD%E6%95%B0">current_timezone函数</a></td> <td>current_timezone()</td> <td>返回当前时区。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#date%E5%87%BD%E6%95%B0">date函数</a></td> <td>date( <em>x</em> )</td> <td>返回日期和时间表达式中的日期部分。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#date_format%E5%87%BD%E6%95%B0">date_format函数</a></td> <td>date_format( <em>x</em> , <em>format</em> )</td> <td>将timestamp类型的日期和时间表达式转化为指定格式的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#date_parse%E5%87%BD%E6%95%B0">date_parse函数</a></td> <td>date_parse( <em>x</em> , <em>format</em> )</td> <td>将日期和时间字符串转换为指定格式的timestamp类型的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#from_iso8601_date%E5%87%BD%E6%95%B0">from_iso8601_date函数</a></td> <td>from_iso8601_date( <em>x</em> )</td> <td>将ISO8601格式的日期表达式转化为date类型的日期表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#from_iso8601_timestamp%E5%87%BD%E6%95%B0">from_iso8601_timestamp函数</a></td> <td>from_iso8601_timestamp( <em>x</em> )</td> <td>将ISO8601格式的日期和时间表达式转化为timestamp类型的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#from_unixtime%E5%87%BD%E6%95%B0">from_unixtime函数</a></td> <td>from_unixtime( <em>x</em> )</td> <td>将UNIX时间戳转化为无时区的timestamp类型的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#from_unixtime%E5%87%BD%E6%95%B0">from_unixtime函数</a></td> <td>from_unixtime( <em>x</em> , <em>time zone</em> )</td> <td>将UNIX时间戳转化为带时区的timestamp类型的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#from_unixtime%E5%87%BD%E6%95%B0">from_unixtime函数</a></td> <td>from_unixtime( <em>x</em> , <em>hours</em> , <em>minutes</em> )</td> <td>将UNIX时间戳转化为带时区的timestamp类型的日期和时间表达式，其中 <em>hours</em> 和 <em>minutes</em> 为时区偏移量。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#localtime%E5%87%BD%E6%95%B0">localtime函数</a></td> <td>localtime</td> <td>返回本地时间。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#localtimestamp%E5%87%BD%E6%95%B0">localtimestamp函数</a></td> <td>localtimestamp</td> <td>返回本地日期和时间。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#now%E5%87%BD%E6%95%B0">now函数</a></td> <td>now()</td> <td>返回当前日期和时间。 now函数等同于current_timestamp函数。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#to_iso8601%E5%87%BD%E6%95%B0">to_iso8601函数</a></td> <td>to_iso8601( <em>x</em> )</td> <td>将date类型或timestamp类型的日期和时间表达式转换为ISO8601格式的日期和时间表达式。</td></tr> <tr><td>日期和时间函数</td> <td><a href="#to_unixtime%E5%87%BD%E6%95%B0">to_unixtime函数</a></td> <td>to_unixtime( <em>x</em> )</td> <td>将timestamp类型的日期和时间表达式转化成UNIX时间戳。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#day%E5%87%BD%E6%95%B0">day函数</a></td> <td>day( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按月计算。 day函数等同于day_of_month函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#day_of_month%E5%87%BD%E6%95%B0">day_of_month函数</a></td> <td>day_of_month( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按月计算。 day_of_month函数等同于day函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#day_of_week%E5%87%BD%E6%95%B0">day_of_week函数</a></td> <td>day_of_week( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按周计算。 day_of_week函数等同于dow函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#day_of_year%E5%87%BD%E6%95%B0">day_of_year函数</a></td> <td>day_of_year( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按年计算。 day_of_year函数等同于doy函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#dow%E5%87%BD%E6%95%B0">dow函数</a></td> <td>dow( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按周计算。 dow函数等同于day_of_week函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#doy%E5%87%BD%E6%95%B0">doy函数</a></td> <td>doy( <em>x</em> )</td> <td>提取日期和时间表达式中的天数，按年计算。 doy函数等同于day_of_year函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#extract%E5%87%BD%E6%95%B0">extract函数</a></td> <td>extract( <em>field</em> from <em>x</em> )</td> <td>通过指定的 <em>field</em> ，提取日期和时间表达式中的日期或时间部分。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#hour%E5%87%BD%E6%95%B0">hour函数</a></td> <td>hour( <em>x</em> )</td> <td>提取日期和时间表达式中的小时数，按24小时制计算。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#minute%E5%87%BD%E6%95%B0">minute函数</a></td> <td>minute( <em>x</em> )</td> <td>提取日期和时间表达式中的分钟数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#month%E5%87%BD%E6%95%B0">month函数</a></td> <td>month( <em>x</em> )</td> <td>提取日期和时间表达式中的月份。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#quarter%E5%87%BD%E6%95%B0">quarter函数</a></td> <td>quarter( <em>x</em> )</td> <td>计算目标日期所属的季度。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#second%E5%87%BD%E6%95%B0">second函数</a></td> <td>second( <em>x</em> )</td> <td>提取日期和时间表达式中的秒数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#timezone_hour%E5%87%BD%E6%95%B0">timezone_hour函数</a></td> <td>timezone_hour( <em>x</em> )</td> <td>计算时区的小时偏移量。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#timezone_minute%E5%87%BD%E6%95%B0">timezone_minute函数</a></td> <td>timezone_minute( <em>x</em> )</td> <td>计算时区的分钟偏移量。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#week%E5%87%BD%E6%95%B0">week函数</a></td> <td>week( <em>x</em> )</td> <td>计算目标日期是在一年中的第几周。 week函数等同于week_of_year函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#week_of_year%E5%87%BD%E6%95%B0">week_of_year函数</a></td> <td>week_of_year( <em>x</em> )</td> <td>计算目标日期是在一年中的第几周。 week_of_year函数等同于week函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#year%E5%87%BD%E6%95%B0">year函数</a></td> <td>year( <em>x</em> )</td> <td>提取目标日期中的年份。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#year_of_week%E5%87%BD%E6%95%B0">year_of_week函数</a></td> <td>year_of_week( <em>x</em> )</td> <td>提取目标日期在ISO周日历中的年份。 year_of_week函数等同于yow函数。</td></tr> <tr><td>日期和时间提取函数</td> <td><a href="#yow%E5%87%BD%E6%95%B0">yow函数</a></td> <td>yow( <em>x</em> )</td> <td>提取目标日期在ISO周日历中的年份。 yow函数等同于year_of_week函数。</td></tr> <tr><td>时间间隔函数</td> <td><a href="#date_trunc%E5%87%BD%E6%95%B0">date_trunc函数</a></td> <td>date_trunc(unit, <em>x</em> )</td> <td>根据您指定的时间单位截断日期和时间表达式，并按照毫秒、秒、分钟，小时、日、月或年对齐。</td></tr> <tr><td>时间间隔函数</td> <td><a href="#date_add%E5%87%BD%E6%95%B0">date_add函数</a></td> <td>date_add( <em>unit</em> , <em>N</em> , <em>x</em> )</td> <td>在 <em>x</em> 上加上N个时间单位（unit）。</td></tr> <tr><td>时间间隔函数</td> <td><a href="#date_diff%E5%87%BD%E6%95%B0">date_diff函数</a></td> <td>date_diff( <em>unit</em> , <em>x</em> , <em>y</em> )</td> <td>返回两个时间表达式之间的时间差值，例如计算 <em>x</em> 和 <em>y</em> 之间相差几个时间单位（unit）。</td></tr> <tr><td>时序补全函数</td> <td><a href="#time_series%E5%87%BD%E6%95%B0">time_series函数</a></td> <td>time_series( <em>x</em> , <em>window</em> , <em>format</em> , <em>padding_data</em> )</td> <td>补全您查询时间窗口内缺失的数据。</td></tr></tbody></table> <h1 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h1> <h2 id="current-date函数"><a href="#current-date函数" class="header-anchor">#</a> current_date函数</h2> <p>current_date函数用于返回当前日期，格式为YYYY-MM-DD。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>current_date
</code></pre></div><p>date类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(current_date)
  AND __time__ &gt; to_unixtime(date_add('day', -1, current_date))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="current-time函数"><a href="#current-time函数" class="header-anchor">#</a> current_time函数</h2> <p>current_time函数用于返回当前时间和时区，格式为HH:MM:SS.Ms Time_zone。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>current_time
</code></pre></div><p>time类型。</p> <p>查询当前时间和时区。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select current_time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3049136261/p294652.png" alt="current_time"></p></li></ul> <h2 id="current-timestamp函数"><a href="#current-timestamp函数" class="header-anchor">#</a> current_timestamp函数</h2> <p>current_timestamp函数用于返回当前日期、时间和时区，格式为YYYY-MM-DD HH:MM:SS.Ms Time_zone。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>current_timestamp
</code></pre></div><p>timestamp类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(current_timestamp)
  AND __time__ &gt; to_unixtime(date_add('day', -1, current_timestamp))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="current-timezone函数"><a href="#current-timezone函数" class="header-anchor">#</a> current_timezone函数</h2> <p>current_timezone函数用于返回当前时区。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>current_timezone()
</code></pre></div><p>varchar类型。</p> <p>查询当前的时区。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select current_timezone()
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3049136261/p294665.png" alt="current_timezone"></p></li></ul> <h2 id="date函数"><a href="#date函数" class="header-anchor">#</a> date函数</h2> <p>date函数用于提取日期和时间表达式中的日期部分。date函数等同于<code>cast(</code> <em>x</em><code>as date)</code>。更多信息，请参见<a href="/vuepress-test-blog/sqlfun/t13115.html#concept-v55-4lq-zdb">类型转换函数</a>。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>date类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用date函数提取日期部分。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, date(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7631001361/p319524.png" alt="date"></p></li></ul> <h2 id="date-format函数"><a href="#date-format函数" class="header-anchor">#</a> date_format函数</h2> <p>date_format函数用于将timestamp类型的日期和时间表达式转换为指定格式的日期和时间字符串。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date_format(x, format)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型的日期和时间表达式。</td></tr> <tr><td><em>format</em></td> <td>日期和时间表达式的转换格式。更多信息，请参见<a href="#LogService-user-guide-0110/section-8g8-2xm-kdv">format说明</a>。</td></tr></tbody></table> <p>varchar类型。</p> <p>计算Nginx请求状态及数量，并根据时间顺序展示。首先通过date_trunc函数将日志时间按照分钟对齐，再使用date_format函数转换为<code>%H:%i</code>格式，然后计算每分钟内每个状态码对应的请求数量，并以流图展示查询和分析结果。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  date_format(date_trunc('minute', __time__), '%H:%i') AS time,
  COUNT(1) AS count,
  status
GROUP BY
  time,
  status
ORDER BY
  time
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7632296261/p296431.png" alt="date_format"></p></li></ul> <h2 id="date-parse函数"><a href="#date-parse函数" class="header-anchor">#</a> date_parse函数</h2> <p>date_parse函数用于将日期和时间字符串转换为指定格式的timestamp类型的日期和时间表达式。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date_parse(x, format)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为日期和时间字符串。</td></tr> <tr><td><em>format</em></td> <td>日期和时间表达式的转换格式。更多信息，请参见<a href="#LogService-user-guide-0110/section-8g8-2xm-kdv">format说明</a>。</td></tr></tbody></table> <p>timestamp类型。</p> <p>将StartTime字段值和EndTime字段值转换为timestamp类型，并计算两者的时间差。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>*|
SELECT
    date_parse(StartTime, '%Y-%m-%d %H:%i') AS &quot;StartTime&quot;,
    date_parse(EndTime, '%Y-%m-%d %H:%i') AS &quot;EndTime&quot;,
    date_diff('hour', StartTime, EndTime) AS &quot;时间差(小时)&quot;
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7632296261/p297055.png" alt=" date_parse("></p></li></ul> <h2 id="from-iso8601-date函数"><a href="#from-iso8601-date函数" class="header-anchor">#</a> from_iso8601_date函数</h2> <p>from_iso8601_date函数用于将ISO8601格式的日期表达式转化为date类型的日期表达式，格式为YYYY-MM-DD。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>from_iso8601_date(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为ISO8601格式的日期表达式。</td></tr></tbody></table> <p>date类型。</p> <p>将time字段的值转换为date类型的日期表达式。</p> <ul><li><p>字段样例</p> <div class="language-unknow extra-class"><pre class="language-text"><code>time:2020-05-03
</code></pre></div></li> <li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select from_iso8601_date(time)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p296884.png" alt="from_iso8601_date"></p></li></ul> <h2 id="from-iso8601-timestamp函数"><a href="#from-iso8601-timestamp函数" class="header-anchor">#</a> from_iso8601_timestamp函数</h2> <p>from_iso8601_timestamp函数用于将ISO8601格式的日期和时间表达式转化为timestamp类型的日期和时间表达式，格式为YYYY-MM-DD HH:MM:SS.Ms Time_zone。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>from_iso8601_timestamp(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为ISO8601格式的日期和时间表达式。</td></tr></tbody></table> <p>timestamp类型。</p> <p>将time字段的值转换为timestamp类型的日期和时间表达式。</p> <ul><li><p>字段样例</p> <div class="language-unknow extra-class"><pre class="language-text"><code>time:2020-05-03T17:30:08
</code></pre></div></li> <li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select from_iso8601_timestamp(time)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p296867.png" alt="from_iso8601_timestamp"></p></li></ul> <h2 id="from-unixtime函数"><a href="#from-unixtime函数" class="header-anchor">#</a> from_unixtime函数</h2> <p>from_unixtime函数用于将UNIX时间戳转化为timestamp类型的日期和时间表达式，格式为YYYY-MM-DD HH:MM:SS.Ms或YYYY-MM-DD HH:MM:SS.Ms Time_zone。</p> <ul><li><p>转化为无时区的timestamp类型的日期和时间表达式</p> <div class="language-unknow extra-class"><pre class="language-text"><code>from_unixtime(x)
</code></pre></div></li> <li><p>转化为带时区的timestamp类型的日期和时间表达式</p> <div class="language-unknow extra-class"><pre class="language-text"><code>from_unixtime(x,time zone)
</code></pre></div></li> <li><p>转化为带时区的timestamp类型的日期和时间表达式，其中 <em>hours</em> 和 <em>minutes</em> 为时区偏移量。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>from_unixtime(x, hours, minutes)
</code></pre></div></li></ul> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为UNIX时间戳。</td></tr> <tr><td><em>time zone</em></td> <td>时区，例如Asia/shanghai。</td></tr> <tr><td><em>hours</em></td> <td>时区的小时偏移量，例如+07、-09</td></tr> <tr><td><em>minutes</em></td> <td>时区的分钟偏移量，例如+30、-45。</td></tr></tbody></table> <p>timestamp类型。</p> <p>将time字段的值转化为带时区的timestamp类型的日期和时间表达式。</p> <ul><li><p>字段样例</p> <div class="language-unknow extra-class"><pre class="language-text"><code>time:1626774758
</code></pre></div></li> <li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select from_unixtime(time,'Asia/shanghai')
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p296879.png" alt="from_unixtime"></p></li></ul> <h2 id="localtime函数"><a href="#localtime函数" class="header-anchor">#</a> localtime函数</h2> <p>localtime函数用于返回本地时间，格式为HH:MM:SS.Ms。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>localtime
</code></pre></div><p>time类型。</p> <p>查询本地时间。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select localtime
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p296880.png" alt="localtime"></p></li></ul> <h2 id="localtimestamp函数"><a href="#localtimestamp函数" class="header-anchor">#</a> localtimestamp函数</h2> <p>localtimestamp函数用于返回本地的日期和时间，格式为YYYY-MM-DD HH:MM:SS.Ms Time_zone。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>localtimestamp
</code></pre></div><p>timestamp类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(localtimestamp)
  AND __time__ &gt; to_unixtime(date_add('day', -1, localtimestamp))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="now函数"><a href="#now函数" class="header-anchor">#</a> now函数</h2> <p>now函数用于返回当前日期和时间，格式为YYYY-MM-DD HH:MM:SS.Ms Time_zone。now函数等同于current_timestamp函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>now()
</code></pre></div><p>timestamp类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(now())
  AND __time__ &gt; to_unixtime(date_add('day', -1, now()))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="to-iso8601函数"><a href="#to-iso8601函数" class="header-anchor">#</a> to_iso8601函数</h2> <p>to_iso8601函数用于将date类型或timestamp类型的日期和时间表达式转换为ISO8601格式的日期和时间表达式。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>to_iso8601(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>varchar类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用to_iso8601函数将当前的日期和时间表达式转换为ISO8601格式的日期和时间表达式。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select to_iso8601(current_timestamp) AS ISO8601
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5075980361/p319567.png" alt="to_iso8601"></p></li></ul> <h2 id="to-unixtime函数"><a href="#to-unixtime函数" class="header-anchor">#</a> to_unixtime函数</h2> <p>to_unixtime函数用于将timestamp类型的日期和时间表达式转化成UNIX时间戳。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>to_unixtime(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型的日期和时间表达式。</td></tr></tbody></table> <p>double类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(now())
  AND __time__ &gt; to_unixtime(date_add('day', -1, now()))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="day函数"><a href="#day函数" class="header-anchor">#</a> day函数</h2> <p>day函数用于提取日期和时间表达式中的天数，按月计算。day函数等同于day_of_month函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>day(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用day函数提取当前日期为本月的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, day(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6932890361/p319585.png" alt="day"></p></li></ul> <h2 id="day-of-month函数"><a href="#day-of-month函数" class="header-anchor">#</a> day_of_month函数</h2> <p>day_of_month函数用于提取日期和时间表达式中的天数，按月计算。day_of_month函数等同于day函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>day_of_month(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用day_of_month函数提取当前日期为本月的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, day_of_month(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6932890361/p319585.png" alt="day"></p></li></ul> <h2 id="day-of-week函数"><a href="#day-of-week函数" class="header-anchor">#</a> day_of_week函数</h2> <p>day_of_week函数用于提取日期和时间表达式中的天数，按周计算。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>day_of_week(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用day_of_week函数提取当前日期为本周的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, day_of_week(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6932890361/p324130.png" alt="day_of_week"></p></li></ul> <h2 id="day-of-year函数"><a href="#day-of-year函数" class="header-anchor">#</a> day_of_year函数</h2> <p>day_of_year函数用于提取日期和时间表达式中的天数，按年计算。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>day_of_year(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用day_of_year函数提取当前日期为本年的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, day_of_year(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324135.png" alt="day_of_year"></p></li></ul> <h2 id="dow函数"><a href="#dow函数" class="header-anchor">#</a> dow函数</h2> <p>dow函数用于提取日期和时间表达式中的天数，按周计算。dow函数等同于day_of_week函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>dow(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用dow函数提取当前日期为本周的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, dow(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6932890361/p324130.png" alt="day_of_week"></p></li></ul> <h2 id="doy函数"><a href="#doy函数" class="header-anchor">#</a> doy函数</h2> <p>doy函数用于提取日期和时间表达式中的天数，按年计算。doy函数等同于day_of_year函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>doy(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp、date类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用doy函数提取当前日期为本年的第几天。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_date, doy(current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324135.png" alt="day_of_year"></p></li></ul> <h2 id="extract函数"><a href="#extract函数" class="header-anchor">#</a> extract函数</h2> <p>extract函数通过指定的 <em>field</em> ，提取日期和时间表达式中的日期或时间部分。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>extract(field from x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>field</em></td> <td>取值为year、quarter、month、week、day、day_of_month、day_of_week、dow、day_of_year、doy、year_of_week、yow、hour、minute、second、timezone_hour、timezone_minute。</td></tr> <tr><td><em>x</em></td> <td>参数值为date、time、timestamp、interval (actual varchar(9)) 类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_date函数获取当前日期，然后使用extract函数提取当前日期中的年份。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT extract(year from current_date)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324242.png" alt="extract"></p></li></ul> <h2 id="hour函数"><a href="#hour函数" class="header-anchor">#</a> hour函数</h2> <p>hour函数用于提取日期和时间表达式中的小时数，按24小时制计算。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>hour(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用hour函数提取当前时间的小时数。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, hour(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324157.png" alt="hour"></p></li></ul> <h2 id="minute函数"><a href="#minute函数" class="header-anchor">#</a> minute函数</h2> <p>minute函数用于提取日期和时间表达式中的分钟数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>minute(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用minute函数提取当前时间的分钟数。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, minute(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324178.png" alt="minute"></p></li></ul> <h2 id="month函数"><a href="#month函数" class="header-anchor">#</a> month函数</h2> <p>month函数用于提取日期和时间表达式中的月份。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>month(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用month函数提取当前日期所属的月份。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, month(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3856990361/p324172.png" alt="month"></p></li></ul> <h2 id="quarter函数"><a href="#quarter函数" class="header-anchor">#</a> quarter函数</h2> <p>quarter函数用于返回日期所属的季度。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>quarter(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用quarter函数计算当前日期所属的季度。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp,quarter(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324189.png" alt="quarter"></p></li></ul> <h2 id="second函数"><a href="#second函数" class="header-anchor">#</a> second函数</h2> <p>second函数用于提取日期和时间表达式中的秒数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>second(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用second函数提取当前时间的秒数。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp,second(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324199.png" alt="second"></p></li></ul> <h2 id="timezone-hour函数"><a href="#timezone-hour函数" class="header-anchor">#</a> timezone_hour函数</h2> <p>timezone_hour函数用于计算时区的小时偏移量。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>timezone_hour(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用timezone_hour函数计算当前时间所属时区的小时偏移量。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, timezone_hour(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324206.png" alt="timezone_hour"></p></li></ul> <h2 id="timezone-minute函数"><a href="#timezone-minute函数" class="header-anchor">#</a> timezone_minute函数</h2> <p>timezone_minute函数用于计算时区的分钟偏移量。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>timezone_minute(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用timezone_minute函数计算当前时间所属时区的分钟偏移量。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp,timezone_minute(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324211.png" alt="timezone_minute"></p></li></ul> <h2 id="week函数"><a href="#week函数" class="header-anchor">#</a> week函数</h2> <p>week函数用于计算目标日期是在一年中的第几周。week函数等同于week_of_year函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>week(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用week函数计算当前日期是一年中的第几周。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, week(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324222.png" alt="week"></p></li></ul> <h2 id="week-of-year函数"><a href="#week-of-year函数" class="header-anchor">#</a> week_of_year函数</h2> <p>week_of_year函数用于计算目标日期是在一年中的第几周。week_of_year函数等同于week函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>week_of_year(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用week_of_year函数计算当前日期是一年中的第几周。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, week_of_year(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324222.png" alt="week"></p></li></ul> <h2 id="year函数"><a href="#year函数" class="header-anchor">#</a> year函数</h2> <p>year函数用于提取目标日期中的年份。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>year(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用year函数提取当前日期中的年份。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp,year(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324224.png" alt="year"></p></li></ul> <h2 id="year-of-week函数"><a href="#year-of-week函数" class="header-anchor">#</a> year_of_week函数</h2> <p>year_of_week函数用于返回目标日期在ISO周日历中的年份。year_of_week函数等同于yow函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>year_of_week(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用year_of_week函数返回当前日期在ISO周日历中的年份。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp,year_of_week(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324228.png" alt="year_of_week"></p></li></ul> <h2 id="yow函数"><a href="#yow函数" class="header-anchor">#</a> yow函数</h2> <p>yow函数用于返回目标日期在ISO周日历中的年份。yow函数等同于year_of_week函数。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>yow(x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>参数值为date、timestamp类型。</td></tr></tbody></table> <p>bigint类型。</p> <p>使用current_timestamp函数获取当前日期和时间，然后使用yow函数返回当前日期在ISO周日历中的年份。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT current_timestamp, yow(current_timestamp)
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4856990361/p324228.png" alt="year_of_week"></p></li></ul> <h2 id="date-trunc函数"><a href="#date-trunc函数" class="header-anchor">#</a> date_trunc函数</h2> <p>date_trunc函数会根据您指定的时间单位截断日期和时间表达式，并按照毫秒、秒、分钟，小时、日、月或年对齐。该函数常用于需要按照时间进行统计分析的场景。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date_trunc(unit, x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>unit</em></td> <td>时间单位，取值为millisecond、second、minute、hour、day、week、month、quarter、year。更多信息，请参见<a href="#LogService-user-guide-0110/section-z07-k3z-j0l">unit说明</a>。</td></tr> <tr><td><em>x</em></td> <td>参数值为日期和时间表达式。</td></tr></tbody></table> <p><strong>说明</strong> date_trunc函数只能按照固定的时间间隔统计（例如每分钟、每小时等）。如果您需要按照灵活的时间维度统计，请使用数学取模方法进行分组，例如统计每5分钟的数据。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT count(1) AS pv,  __time__ - __time__ %300 AS time GROUP BY time LIMIT 100
</code></pre></div><p>与参数值的类型一致。</p> <p>按照每分钟的时间粒度计算请求时间的平均值，并按照时间进行分组和排序。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  date_trunc('minute', __time__) AS time,
  truncate (avg(request_time)) AS avg_time,
  current_date AS date
GROUP BY
  time
ORDER BY
  time DESC
LIMIT
  100
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7632296261/p297061.png" alt="date_trunc"></p></li></ul> <h2 id="date-add函数"><a href="#date-add函数" class="header-anchor">#</a> date_add函数</h2> <p>date_add函数用于在日期或时间中添加或减去指定的时间间隔。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date_add(unit, n, x)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>unit</em></td> <td>时间单位，取值为millisecond、second、minute、hour、day、week、month、quarter、year。更多信息，请参见<a href="#LogService-user-guide-0110/section-z07-k3z-j0l">unit说明</a>。</td></tr> <tr><td><em>n</em></td> <td>时间间隔。</td></tr> <tr><td><em>x</em></td> <td>参数值为timestamp类型日期和时间表达式。</td></tr></tbody></table> <p>timestamp类型。</p> <p>查询昨天的日志。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* |
SELECT
  *
FROM  log
WHERE
  __time__ &lt; to_unixtime(current_date)
  AND __time__ &gt; to_unixtime(date_add('day', -1, current_date))
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6632296261/p295473.png" alt="current_date"></p></li></ul> <h2 id="date-diff函数"><a href="#date-diff函数" class="header-anchor">#</a> date_diff函数</h2> <p>date_diff函数用于计算两个日期或时间之间的差值。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>date_diff(unit, x, y)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>unit</em></td> <td>时间单位，取值为millisecond、second、minute、hour、day、week、month、quarter、year。更多信息，请参见<a href="#LogService-user-guide-0110/section-z07-k3z-j0l">unit说明</a>。</td></tr> <tr><td><em>x</em></td> <td>参数值为timestamp类型日期和时间表达式。</td></tr> <tr><td><em>y</em></td> <td>参数值为timestamp类型日期和时间表达式。</td></tr></tbody></table> <p>bigint类型。</p> <p>通过UsageStartTime字段和UsageEndTime字段计算服务器使用的总时长。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | SELECT  date_diff('hour', UsageStartTime, UsageEndTime) AS &quot;时间差(小时)&quot;
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1896647261/p299364.png" alt="date_diff"></p></li></ul> <h2 id="time-series函数"><a href="#time-series函数" class="header-anchor">#</a> time_series函数</h2> <p>time_series函数用于补全您查询时间窗口内缺失的数据。
<strong>注意</strong> time_series函数必须搭配GROUP BY语法和ORDER BY语法使用，且ORDER BY语法不支持DESC排序方式。</p> <div class="language-unknow extra-class"><pre class="language-text"><code>time_series(x, window_time, format, padding_data)
</code></pre></div><table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><em>x</em></td> <td>时间列，例如__time__。时间列的值为long类型或timestamp类型。</td></tr> <tr><td><em>window_time</em></td> <td>窗口大小，单位为s（秒）、m（分）、h（小时）、d（天）。例如2h、5m、3d。</td></tr> <tr><td><em>format</em></td> <td>返回结果的时间格式。更多信息，请参见<a href="#LogService-user-guide-0110/section-8g8-2xm-kdv">format说明</a>。</td></tr> <tr><td><em>padding_data</em></td> <td>补全的内容。包括： * 0：将缺失的值设置为0。  * null：将缺失的值设置为null。  * last：将缺失的值设置了上一个时间点对应的值。  * next：将缺失的值设置了下一个时间点对应的值。  * avg：将缺失的值设置为前后两个时间点的平均值。</td></tr></tbody></table> <p>bigint类型。</p> <p>按照两个小时的时间粒度进行数据补全，将缺失的值设置为0。</p> <ul><li><p>查询和分析语句</p> <div class="language-unknow extra-class"><pre class="language-text"><code>* | select time_series(__time__, '2h', '%Y-%m-%d %H:%i:%s', '0')  as time, count(*) as num from log group by time order by time                        
</code></pre></div></li> <li><p>查询和分析结果</p> <p><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0942576261/p37530.png" alt="时间补全函数示例图"></p></li></ul> <h2 id="format说明"><a href="#format说明" class="header-anchor">#</a> format说明</h2> <table><thead><tr><th>format</th> <th>说明</th></tr></thead> <tbody><tr><td>%a</td> <td>星期的缩写。例如Sun、Sat。</td></tr> <tr><td>%b</td> <td>月份的缩写。例如Jan、Dec。</td></tr> <tr><td>%c</td> <td>月份。数值类型，取值范围为1~12。</td></tr> <tr><td>%D</td> <td>每月的第几天。需加上后缀，例如0th、1st、2nd、3rd。</td></tr> <tr><td>%d</td> <td>每月的第几天。十进制格式，取值范围为01~31。</td></tr> <tr><td>%e</td> <td>每月的第几天。十进制格式，取值范围为1~31。</td></tr> <tr><td>%H</td> <td>小时，24小时制。</td></tr> <tr><td>%h</td> <td>小时，12小时制。</td></tr> <tr><td>%I</td> <td>小时，12小时制。</td></tr> <tr><td>%i</td> <td>分钟。数值类型，取值范围为00~59。</td></tr> <tr><td>%j</td> <td>每年的第几天。取值范围为001~366。</td></tr> <tr><td>%k</td> <td>小时。取值范围为0~23。</td></tr> <tr><td>%l</td> <td>小时。取值范围为1~12。</td></tr> <tr><td>%M</td> <td>月份的英文表达，例如January、December。</td></tr> <tr><td>%m</td> <td>月份。数值格式，取值范围为01~12。</td></tr> <tr><td>%p</td> <td>AM、PM。</td></tr> <tr><td>%r</td> <td>时间。12小时制，格式为<code>hh:mm:ss AM/PM</code>。</td></tr> <tr><td>%S</td> <td>秒。取值范围为00~59。</td></tr> <tr><td>%s</td> <td>秒。取值范围为00~59。</td></tr> <tr><td>%T</td> <td>时间。24小时制，格式为<code>hh:mm:ss</code>。</td></tr> <tr><td>%V</td> <td>每年的第几周，星期日是一周的第一天。取值范围为01~53。</td></tr> <tr><td>%v</td> <td>每年的第几周，星期一是一周的第一天。取值范围为01~53。</td></tr> <tr><td>%W</td> <td>星期几的名称。例如Sunday、Saturday。</td></tr> <tr><td>%w</td> <td>一周的第几天，星期日为第0天。</td></tr> <tr><td>%Y</td> <td>4位数的年份。例如2020。</td></tr> <tr><td>%y</td> <td>2位数的年份。例如20。</td></tr> <tr><td>%%</td> <td>%的转义字符。</td></tr></tbody></table> <h2 id="unit说明"><a href="#unit说明" class="header-anchor">#</a> unit说明</h2> <table><thead><tr><th>unit</th> <th>说明</th></tr></thead> <tbody><tr><td>millisecond</td> <td>毫秒</td></tr> <tr><td>second</td> <td>秒</td></tr> <tr><td>minute</td> <td>分钟</td></tr> <tr><td>hour</td> <td>小时</td></tr> <tr><td>day</td> <td>天</td></tr> <tr><td>week</td> <td>周</td></tr> <tr><td>month</td> <td>月</td></tr> <tr><td>quarter</td> <td>季度</td></tr> <tr><td>year</td> <td>年</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-test-blog/sqlfun/2字符串函数.html" class="prev">
        字符串函数
      </a></span> <span class="next"><a href="/vuepress-test-blog/sqlfun/4JSON函数.html">
        JSON函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-test-blog/assets/js/app.1b4f8edd.js" defer></script><script src="/vuepress-test-blog/assets/js/2.bce32082.js" defer></script><script src="/vuepress-test-blog/assets/js/15.ae954753.js" defer></script>
  </body>
</html>
